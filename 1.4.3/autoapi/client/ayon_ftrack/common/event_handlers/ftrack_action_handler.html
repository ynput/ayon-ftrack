<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=index.html><link rel=next href=ftrack_base_handler.html><link rel=icon href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>ftrack_action_handler - ayon-ftrack</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../../../css/custom.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../../index.html title=ayon-ftrack class="md-header__button md-logo" aria-label=ayon-ftrack data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ayon-ftrack </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ftrack_action_handler </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ynput/ayon-ftrack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../../index.html title=ayon-ftrack class="md-nav__button md-logo" aria-label=ayon-ftrack data-md-component=logo> <img src=../../../../../img/ay-symbol-blackw-full.png alt=logo> </a> ayon-ftrack </label> <div class=md-nav__source> <a href=https://github.com/ynput/ayon-ftrack title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../index.html class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../../../../license.html class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> client </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> client </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../../index.html class="md-nav__link "> <span class=md-ellipsis> ayon_ftrack </span> </a> <label class="md-nav__link " for=__nav_3_1_1 id=__nav_3_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> ayon_ftrack </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_1 checked> <div class="md-nav__link md-nav__container"> <a href=../index.html class="md-nav__link "> <span class=md-ellipsis> common </span> </a> <label class="md-nav__link " for=__nav_3_1_1_1 id=__nav_3_1_1_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_1_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_1> <span class="md-nav__icon md-icon"></span> common </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../constants.html class=md-nav__link> <span class=md-ellipsis> constants </span> </a> </li> <li class=md-nav__item> <a href=../custom_attributes.html class=md-nav__link> <span class=md-ellipsis> custom_attributes </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1_1_1_3 checked> <div class="md-nav__link md-nav__container"> <a href=index.html class="md-nav__link "> <span class=md-ellipsis> event_handlers </span> </a> <label class="md-nav__link " for=__nav_3_1_1_1_3 id=__nav_3_1_1_1_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=5 aria-labelledby=__nav_3_1_1_1_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3_1_1_1_3> <span class="md-nav__icon md-icon"></span> event_handlers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> ftrack_action_handler </span> <span class="md-nav__icon md-icon"></span> </label> <a href=ftrack_action_handler.html class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> ftrack_action_handler </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler class=md-nav__link> <span class=md-ellipsis> ftrack_action_handler </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction class=md-nav__link> <span class=md-ellipsis> BaseAction </span> </a> <nav class=md-nav aria-label=BaseAction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.full_label class=md-nav__link> <span class=md-ellipsis> full_label </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.discover class=md-nav__link> <span class=md-ellipsis> discover </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_project_name_from_event_with_entities class=md-nav__link> <span class=md-ellipsis> get_project_name_from_event_with_entities </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_entity_from_event class=md-nav__link> <span class=md-ellipsis> get_user_entity_from_event </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_roles_from_event class=md-nav__link> <span class=md-ellipsis> get_user_roles_from_event </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.interface class=md-nav__link> <span class=md-ellipsis> interface </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.launch class=md-nav__link> <span class=md-ellipsis> launch </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.register class=md-nav__link> <span class=md-ellipsis> register </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.roles_check class=md-nav__link> <span class=md-ellipsis> roles_check </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.valid_roles class=md-nav__link> <span class=md-ellipsis> valid_roles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction class=md-nav__link> <span class=md-ellipsis> LocalAction </span> </a> <nav class=md-nav aria-label=LocalAction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.full_launch_identifier class=md-nav__link> <span class=md-ellipsis> full_launch_identifier </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.launch_identifier class=md-nav__link> <span class=md-ellipsis> launch_identifier </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.register class=md-nav__link> <span class=md-ellipsis> register </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.ServerAction class=md-nav__link> <span class=md-ellipsis> ServerAction </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=ftrack_base_handler.html class=md-nav__link> <span class=md-ellipsis> ftrack_base_handler </span> </a> </li> <li class=md-nav__item> <a href=ftrack_event_handler.html class=md-nav__link> <span class=md-ellipsis> ftrack_event_handler </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../exceptions.html class=md-nav__link> <span class=md-ellipsis> exceptions </span> </a> </li> <li class=md-nav__item> <a href=../ftrack_server.html class=md-nav__link> <span class=md-ellipsis> ftrack_server </span> </a> </li> <li class=md-nav__item> <a href=../lib.html class=md-nav__link> <span class=md-ellipsis> lib </span> </a> </li> <li class=md-nav__item> <a href=../python_module_tools.html class=md-nav__link> <span class=md-ellipsis> python_module_tools </span> </a> </li> <li class=md-nav__item> <a href=../users.html class=md-nav__link> <span class=md-ellipsis> users </span> </a> </li> <li class=md-nav__item> <a href=../utils.html class=md-nav__link> <span class=md-ellipsis> utils </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../event_handlers_to_convert/action_delete_old_versions.html class=md-nav__link> <span class=md-ellipsis> event_handlers_to_convert </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../event_handlers_user/action_applications.html class=md-nav__link> <span class=md-ellipsis> event_handlers_user </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../ftrack_addon.html class=md-nav__link> <span class=md-ellipsis> ftrack_addon </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../launch_hooks/post_ftrack_changes.html class=md-nav__link> <span class=md-ellipsis> launch_hooks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../lib/credentials.html class=md-nav__link> <span class=md-ellipsis> lib </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../pipeline/plugin.html class=md-nav__link> <span class=md-ellipsis> pipeline </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../plugins/_unused_publish/integrate_ftrack_comments.html class=md-nav__link> <span class=md-ellipsis> plugins </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../resources/index.html class=md-nav__link> <span class=md-ellipsis> resources </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../scripts/sub_user_server.html class=md-nav__link> <span class=md-ellipsis> scripts </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tray/ftrack_tray.html class=md-nav__link> <span class=md-ellipsis> tray </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../version.html class=md-nav__link> <span class=md-ellipsis> version </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../server/ftrack_session.html class=md-nav__link> <span class=md-ellipsis> server </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../service_tools/main.html class=md-nav__link> <span class=md-ellipsis> service_tools </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../services/leecher/leecher/__main__.html class=md-nav__link> <span class=md-ellipsis> services </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler class=md-nav__link> <span class=md-ellipsis> ftrack_action_handler </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction class=md-nav__link> <span class=md-ellipsis> BaseAction </span> </a> <nav class=md-nav aria-label=BaseAction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.full_label class=md-nav__link> <span class=md-ellipsis> full_label </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.discover class=md-nav__link> <span class=md-ellipsis> discover </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_project_name_from_event_with_entities class=md-nav__link> <span class=md-ellipsis> get_project_name_from_event_with_entities </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_entity_from_event class=md-nav__link> <span class=md-ellipsis> get_user_entity_from_event </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_roles_from_event class=md-nav__link> <span class=md-ellipsis> get_user_roles_from_event </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.interface class=md-nav__link> <span class=md-ellipsis> interface </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.launch class=md-nav__link> <span class=md-ellipsis> launch </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.register class=md-nav__link> <span class=md-ellipsis> register </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.roles_check class=md-nav__link> <span class=md-ellipsis> roles_check </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.valid_roles class=md-nav__link> <span class=md-ellipsis> valid_roles </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction class=md-nav__link> <span class=md-ellipsis> LocalAction </span> </a> <nav class=md-nav aria-label=LocalAction> <ul class=md-nav__list> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.full_launch_identifier class=md-nav__link> <span class=md-ellipsis> full_launch_identifier </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.launch_identifier class=md-nav__link> <span class=md-ellipsis> launch_identifier </span> </a> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.register class=md-nav__link> <span class=md-ellipsis> register </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.ServerAction class=md-nav__link> <span class=md-ellipsis> ServerAction </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>ftrack_action_handler</h1> <div class="doc doc-object doc-module"> <a id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler></a> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction class="doc doc-heading"> <code>BaseAction</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="BaseHandler (client.ayon_ftrack.common.event_handlers.ftrack_base_handler.BaseHandler)" href=ftrack_base_handler.html#client.ayon_ftrack.common.event_handlers.ftrack_base_handler.BaseHandler>BaseHandler</a></code></p> <p>Custom Action base class.</p> <p>Simplify action discovery and launch. This implementation represents single action with single callback. To change the behavior implement custom callbacks or override '_discover' and '_launch' methods.</p> <p><span class=doc-section-title>Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code><span title=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.label>label</span></code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Label of action of group name of action. Can be combined with 'variant' attribute.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.variant>variant</span></code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Variant under 'label'. Can be combined with 'label' e.g. when 'label' is "Admin" and variant is "Kill jobs". In case there is more variants for "Admin" label they'll grouped in ftrack UI widgets.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.identifier>identifier</span></code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Action identifier. Is used to trigger the launch logic of action.</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.icon>icon</span></code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Url to icon (Browser which should show the icon must have access to the resource).</p> </div> </td> </tr> <tr class=doc-section-item> <td><code><span title=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.description>description</span></code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Hint of action which is showed to user hovering over the action.</p> </div> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Connected ftrack session.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span>
<span class=normal>124</span>
<span class=normal>125</span>
<span class=normal>126</span>
<span class=normal>127</span>
<span class=normal>128</span>
<span class=normal>129</span>
<span class=normal>130</span>
<span class=normal>131</span>
<span class=normal>132</span>
<span class=normal>133</span>
<span class=normal>134</span>
<span class=normal>135</span>
<span class=normal>136</span>
<span class=normal>137</span>
<span class=normal>138</span>
<span class=normal>139</span>
<span class=normal>140</span>
<span class=normal>141</span>
<span class=normal>142</span>
<span class=normal>143</span>
<span class=normal>144</span>
<span class=normal>145</span>
<span class=normal>146</span>
<span class=normal>147</span>
<span class=normal>148</span>
<span class=normal>149</span>
<span class=normal>150</span>
<span class=normal>151</span>
<span class=normal>152</span>
<span class=normal>153</span>
<span class=normal>154</span>
<span class=normal>155</span>
<span class=normal>156</span>
<span class=normal>157</span>
<span class=normal>158</span>
<span class=normal>159</span>
<span class=normal>160</span>
<span class=normal>161</span>
<span class=normal>162</span>
<span class=normal>163</span>
<span class=normal>164</span>
<span class=normal>165</span>
<span class=normal>166</span>
<span class=normal>167</span>
<span class=normal>168</span>
<span class=normal>169</span>
<span class=normal>170</span>
<span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span>
<span class=normal>195</span>
<span class=normal>196</span>
<span class=normal>197</span>
<span class=normal>198</span>
<span class=normal>199</span>
<span class=normal>200</span>
<span class=normal>201</span>
<span class=normal>202</span>
<span class=normal>203</span>
<span class=normal>204</span>
<span class=normal>205</span>
<span class=normal>206</span>
<span class=normal>207</span>
<span class=normal>208</span>
<span class=normal>209</span>
<span class=normal>210</span>
<span class=normal>211</span>
<span class=normal>212</span>
<span class=normal>213</span>
<span class=normal>214</span>
<span class=normal>215</span>
<span class=normal>216</span>
<span class=normal>217</span>
<span class=normal>218</span>
<span class=normal>219</span>
<span class=normal>220</span>
<span class=normal>221</span>
<span class=normal>222</span>
<span class=normal>223</span>
<span class=normal>224</span>
<span class=normal>225</span>
<span class=normal>226</span>
<span class=normal>227</span>
<span class=normal>228</span>
<span class=normal>229</span>
<span class=normal>230</span>
<span class=normal>231</span>
<span class=normal>232</span>
<span class=normal>233</span>
<span class=normal>234</span>
<span class=normal>235</span>
<span class=normal>236</span>
<span class=normal>237</span>
<span class=normal>238</span>
<span class=normal>239</span>
<span class=normal>240</span>
<span class=normal>241</span>
<span class=normal>242</span>
<span class=normal>243</span>
<span class=normal>244</span>
<span class=normal>245</span>
<span class=normal>246</span>
<span class=normal>247</span>
<span class=normal>248</span>
<span class=normal>249</span>
<span class=normal>250</span>
<span class=normal>251</span>
<span class=normal>252</span>
<span class=normal>253</span>
<span class=normal>254</span>
<span class=normal>255</span>
<span class=normal>256</span>
<span class=normal>257</span>
<span class=normal>258</span>
<span class=normal>259</span>
<span class=normal>260</span>
<span class=normal>261</span>
<span class=normal>262</span>
<span class=normal>263</span>
<span class=normal>264</span>
<span class=normal>265</span>
<span class=normal>266</span>
<span class=normal>267</span>
<span class=normal>268</span>
<span class=normal>269</span>
<span class=normal>270</span>
<span class=normal>271</span>
<span class=normal>272</span>
<span class=normal>273</span>
<span class=normal>274</span>
<span class=normal>275</span>
<span class=normal>276</span>
<span class=normal>277</span>
<span class=normal>278</span>
<span class=normal>279</span>
<span class=normal>280</span>
<span class=normal>281</span>
<span class=normal>282</span>
<span class=normal>283</span>
<span class=normal>284</span>
<span class=normal>285</span>
<span class=normal>286</span>
<span class=normal>287</span>
<span class=normal>288</span>
<span class=normal>289</span>
<span class=normal>290</span>
<span class=normal>291</span>
<span class=normal>292</span>
<span class=normal>293</span>
<span class=normal>294</span>
<span class=normal>295</span>
<span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span>
<span class=normal>315</span>
<span class=normal>316</span>
<span class=normal>317</span>
<span class=normal>318</span>
<span class=normal>319</span>
<span class=normal>320</span>
<span class=normal>321</span>
<span class=normal>322</span>
<span class=normal>323</span>
<span class=normal>324</span>
<span class=normal>325</span>
<span class=normal>326</span>
<span class=normal>327</span>
<span class=normal>328</span>
<span class=normal>329</span>
<span class=normal>330</span>
<span class=normal>331</span>
<span class=normal>332</span>
<span class=normal>333</span>
<span class=normal>334</span>
<span class=normal>335</span>
<span class=normal>336</span>
<span class=normal>337</span>
<span class=normal>338</span>
<span class=normal>339</span>
<span class=normal>340</span>
<span class=normal>341</span>
<span class=normal>342</span>
<span class=normal>343</span>
<span class=normal>344</span>
<span class=normal>345</span>
<span class=normal>346</span>
<span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span>
<span class=normal>374</span>
<span class=normal>375</span>
<span class=normal>376</span>
<span class=normal>377</span>
<span class=normal>378</span>
<span class=normal>379</span>
<span class=normal>380</span>
<span class=normal>381</span>
<span class=normal>382</span>
<span class=normal>383</span>
<span class=normal>384</span>
<span class=normal>385</span>
<span class=normal>386</span>
<span class=normal>387</span>
<span class=normal>388</span>
<span class=normal>389</span>
<span class=normal>390</span>
<span class=normal>391</span>
<span class=normal>392</span>
<span class=normal>393</span>
<span class=normal>394</span>
<span class=normal>395</span>
<span class=normal>396</span>
<span class=normal>397</span>
<span class=normal>398</span>
<span class=normal>399</span>
<span class=normal>400</span>
<span class=normal>401</span>
<span class=normal>402</span>
<span class=normal>403</span>
<span class=normal>404</span>
<span class=normal>405</span>
<span class=normal>406</span>
<span class=normal>407</span>
<span class=normal>408</span>
<span class=normal>409</span>
<span class=normal>410</span>
<span class=normal>411</span>
<span class=normal>412</span>
<span class=normal>413</span>
<span class=normal>414</span>
<span class=normal>415</span>
<span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span>
<span class=normal>445</span>
<span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span>
<span class=normal>474</span>
<span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span>
<span class=normal>506</span>
<span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span>
<span class=normal>537</span>
<span class=normal>538</span>
<span class=normal>539</span>
<span class=normal>540</span>
<span class=normal>541</span>
<span class=normal>542</span>
<span class=normal>543</span>
<span class=normal>544</span>
<span class=normal>545</span>
<span class=normal>546</span>
<span class=normal>547</span>
<span class=normal>548</span>
<span class=normal>549</span>
<span class=normal>550</span>
<span class=normal>551</span>
<span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>BaseAction</span><span class=p>(</span><span class=n>BaseHandler</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Custom Action base class.</span>

<span class=sd>    Simplify action discovery and launch. This implementation represents</span>
<span class=sd>    single action with single callback. To change the behavior implement</span>
<span class=sd>    custom callbacks or override &#39;_discover&#39; and &#39;_launch&#39; methods.</span>

<span class=sd>    Attributes:</span>
<span class=sd>        label (str): Label of action of group name of action. Can be combined</span>
<span class=sd>            with &#39;variant&#39; attribute.</span>
<span class=sd>        variant (str): Variant under &#39;label&#39;. Can be combined with &#39;label&#39; e.g.</span>
<span class=sd>            when &#39;label&#39; is &quot;Admin&quot; and variant is &quot;Kill jobs&quot;. In case</span>
<span class=sd>            there is more variants for &quot;Admin&quot; label they&#39;ll grouped in ftrack</span>
<span class=sd>            UI widgets.</span>
<span class=sd>        identifier (str): Action identifier. Is used to trigger the launch</span>
<span class=sd>            logic of action.</span>
<span class=sd>        icon (str): Url to icon (Browser which should show the icon must have</span>
<span class=sd>            access to the resource).</span>
<span class=sd>        description (str): Hint of action which is showed to user hovering</span>
<span class=sd>            over the action.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Connected ftrack session.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>__ignore_handler_class</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=n>label</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>variant</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>identifier</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>description</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>icon</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>handler_type</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;Action&quot;</span>
    <span class=n>preactions</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>

    <span class=n>_full_label</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>_discover_identifier</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=n>_launch_identifier</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=n>settings_frack_subkey</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;user_handlers&quot;</span>
    <span class=n>settings_enabled_key</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;enabled&quot;</span>

    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>):</span>
        <span class=c1># Validate minimum requirements</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>label</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Action missing &#39;label&#39;.&quot;</span><span class=p>)</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>:</span>
            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Action missing &#39;identifier&#39;.&quot;</span><span class=p>)</span>

        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>session</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>setup_launch_wrapper</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>setup_launch_wrapper</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_launch</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>launch_wrapper</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>_launch</span><span class=p>)</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>discover_identifier</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>launch_identifier</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>handler_label</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_label</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>full_label</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Full label of action.</span>

<span class=sd>        Value of full label is cached.</span>

<span class=sd>        Returns:</span>
<span class=sd>            str: Label created from &#39;label&#39; and &#39;variant&#39; attributes.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_full_label</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>variant</span><span class=p>:</span>
                <span class=n>label</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>label</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>variant</span><span class=p>)</span>
            <span class=k>else</span><span class=p>:</span>
                <span class=n>label</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>label</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_full_label</span> <span class=o>=</span> <span class=n>label</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_full_label</span>

    <span class=k>def</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Register to ftrack topics to discover and launch action.&quot;&quot;&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
            <span class=s2>&quot;topic=ftrack.action.discover&quot;</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_discover</span><span class=p>,</span>
            <span class=n>priority</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>priority</span>
        <span class=p>)</span>

        <span class=n>launch_subscription</span> <span class=o>=</span> <span class=p>(</span>
            <span class=s2>&quot;topic=ftrack.action.launch and data.actionIdentifier=</span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>launch_identifier</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=n>launch_subscription</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_launch</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_translate_event</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Translate event to receive entities based on it&#39;s data.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=n>session</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=n>session</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span>

        <span class=n>_entities</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;entities_object&quot;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>_entities</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>_entities</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>_entities</span>

        <span class=k>if</span> <span class=p>(</span>
            <span class=n>_entities</span> <span class=ow>is</span> <span class=kc>None</span>
            <span class=ow>or</span> <span class=n>_entities</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;link&quot;</span><span class=p>)</span> <span class=o>==</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>symbol</span><span class=o>.</span><span class=n>NOT_SET</span>
        <span class=p>):</span>
            <span class=n>_entities</span> <span class=o>=</span> <span class=p>[</span>
                <span class=n>item</span>
                <span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_entities</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>session</span><span class=o>=</span><span class=n>session</span><span class=p>)</span>
                <span class=k>if</span> <span class=n>item</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
            <span class=p>]</span>
            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;entities_object&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>_entities</span>

        <span class=k>return</span> <span class=n>_entities</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_discover</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Decide if and how will be action showed to user in ftrack.</span>

<span class=sd>        Args:</span>
<span class=sd>            event (ftrack_api.Event): Event with topic which triggered this</span>
<span class=sd>                callback.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[None, Dict[str, Any]]: None if action is not returned</span>
<span class=sd>                otherwise returns items to show in UI (structure of items is</span>
<span class=sd>                defined by ftrack and can be found in documentation).</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>entities</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_translate_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>entities</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=n>accepts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>discover</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>accepts</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Discovering action with selection: </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;selection&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>[]</span>
        <span class=p>))</span>

        <span class=k>return</span> <span class=p>{</span>
            <span class=s2>&quot;items&quot;</span><span class=p>:</span> <span class=p>[{</span>
                <span class=s2>&quot;label&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>label</span><span class=p>,</span>
                <span class=s2>&quot;variant&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>variant</span><span class=p>,</span>
                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>description</span><span class=p>,</span>
                <span class=s2>&quot;actionIdentifier&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>discover_identifier</span><span class=p>,</span>
                <span class=s2>&quot;icon&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>icon</span><span class=p>,</span>
            <span class=p>}]</span>
        <span class=p>}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>discover</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Decide if action is showed to used based on event data.</span>

<span class=sd>        Action should override the method to implement logic to show the</span>
<span class=sd>        action. The most common logic is based on combination of user roles</span>
<span class=sd>        and selected entities.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): Session which triggered callback of</span>
<span class=sd>                the event.</span>
<span class=sd>            entities (List[Any]): Prepared list of entities from event data.</span>
<span class=sd>            event (ftrack_api.Event): ftrack event which caused this callback</span>
<span class=sd>                is triggered.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: True if action should be returned.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_handle_preactions</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Launch actions before launching this action.</span>

<span class=sd>        Concept came from Pype and got deprecated (and used) over time. Should</span>
<span class=sd>        be probably removed.</span>

<span class=sd>        Note:</span>
<span class=sd>            Added warning log that this functionlity is deprecated and will</span>
<span class=sd>                be removed in the future.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): ftrack session.</span>
<span class=sd>            event (ftrack_api.Event): Event which triggered launch of this</span>
<span class=sd>                action.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: Preactions were launched or not.</span>

<span class=sd>        Deprecated:</span>
<span class=sd>            Preactions are marked as deprecated. Server actions should not</span>
<span class=sd>                use preactions and local actions use local identifier which</span>
<span class=sd>                is hard to handle automatically</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># If preactions are not set</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>preactions</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=k>if</span> <span class=ow>not</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;data&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;selection&quot;</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>False</span>

        <span class=c1># If preactions were already started</span>
        <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;preactions_launched&quot;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>True</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>warning</span><span class=p>((</span>
            <span class=s2>&quot;DEPRECATION WARNING: Action </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2> is using &#39;preactions&#39;&quot;</span>
            <span class=s2>&quot; which are deprecated and will be removed Q2 2023.&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>full_label</span><span class=p>))</span>

        <span class=c1># Launch preactions</span>
        <span class=k>for</span> <span class=n>preaction</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>preactions</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>trigger_action</span><span class=p>(</span><span class=n>preaction</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>

        <span class=c1># Relaunch this action</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>trigger_action</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>launch_identifier</span><span class=p>,</span>
            <span class=n>event</span><span class=p>,</span>
            <span class=n>additional_event_data</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;preactions_launched&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=k>def</span><span class=w> </span><span class=nf>launch_wrapper</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>):</span>
        <span class=nd>@functools</span><span class=o>.</span><span class=n>wraps</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=k>def</span><span class=w> </span><span class=nf>wrapper_func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>: Launched&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>handler_type</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_label</span>
            <span class=p>))</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=n>output</span> <span class=o>=</span> <span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&quot;</span><span class=si>{}</span><span class=s2> </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>: Finished&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>handler_type</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_label</span>
                <span class=p>))</span>

            <span class=k>except</span> <span class=ne>BaseException</span> <span class=k>as</span> <span class=n>exc</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>rollback</span><span class=p>()</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>_configure_locations</span><span class=p>()</span>
                <span class=n>msg</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>: Failed (</span><span class=si>{}</span><span class=s2>)&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>handler_type</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_label</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>exc</span><span class=p>))</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span> <span class=n>exc_info</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
                <span class=n>output</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
                    <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=n>msg</span>
                <span class=p>}</span>

            <span class=k>return</span> <span class=n>output</span>
        <span class=k>return</span> <span class=n>wrapper_func</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_launch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=n>entities</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_translate_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>entities</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>preactions_launched</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_preactions</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>preactions_launched</span> <span class=ow>is</span> <span class=kc>False</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>interface</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_interface</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>interface</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>interface</span>

        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>launch</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>

        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_handle_result</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>launch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Main part of handling event callback.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): Session which queried entities.</span>
<span class=sd>            entities (List[Any]): Prequeried entities based on event data.</span>
<span class=sd>            event (ftrack_api.Event): ftrack event to process.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[bool, Dict[str, Any]]: True or false for success or fail,</span>
<span class=sd>                or more complex data structure e.g. to show interface to user.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_interface</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=n>interface</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>interface</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>interface</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>interface</span><span class=p>,</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>)):</span>
            <span class=k>return</span> <span class=p>{</span><span class=s2>&quot;items&quot;</span><span class=p>:</span> <span class=n>interface</span><span class=p>}</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>interface</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
            <span class=k>if</span> <span class=p>(</span>
                <span class=s2>&quot;items&quot;</span> <span class=ow>in</span> <span class=n>interface</span>
                <span class=ow>or</span> <span class=p>(</span><span class=s2>&quot;success&quot;</span> <span class=ow>in</span> <span class=n>interface</span> <span class=ow>and</span> <span class=s2>&quot;message&quot;</span> <span class=ow>in</span> <span class=n>interface</span><span class=p>)</span>
            <span class=p>):</span>
                <span class=k>return</span> <span class=n>interface</span>

            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>((</span>
                <span class=s2>&quot;Invalid interface output expected key: </span><span class=se>\&quot;</span><span class=s2>items</span><span class=se>\&quot;</span><span class=s2> or keys:&quot;</span>
                <span class=s2>&quot; </span><span class=se>\&quot;</span><span class=s2>success</span><span class=se>\&quot;</span><span class=s2> and </span><span class=se>\&quot;</span><span class=s2>message</span><span class=se>\&quot;</span><span class=s2>. Got: </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span>
            <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>interface</span><span class=p>)))</span>

        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
            <span class=s2>&quot;Invalid interface output type </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>interface</span><span class=p>))</span>
            <span class=p>)</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>interface</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Show an interface to user befor the action is processed.</span>

<span class=sd>        This is part of launch callback which gives option to return ftrack</span>
<span class=sd>        widgets items. These items are showed to user which can fill/change</span>
<span class=sd>        values and submit them.</span>

<span class=sd>        Interface must in that case handle if event contains values from user.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): Connected ftrack api session.</span>
<span class=sd>            entities (List[Any]): Entities on which was action triggered.</span>
<span class=sd>            event (ftrack_api.Event): Event which triggered launch callback.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Union[None, List[Dict[str, Any], Dict[str, Any]]: None if nothing</span>
<span class=sd>                should be showed, list of items to show or dictionary with</span>
<span class=sd>                &#39;items&#39; key and possibly additional data</span>
<span class=sd>                (e.g. submit button label).</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>return</span> <span class=kc>None</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_handle_result</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>result</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate the returned result from the action callback.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>result</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>None</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=nb>dict</span><span class=p>):</span>
            <span class=k>if</span> <span class=s2>&quot;items&quot;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;items&quot;</span><span class=p>],</span> <span class=nb>list</span><span class=p>):</span>
                    <span class=k>raise</span> <span class=ne>TypeError</span><span class=p>(</span>
                        <span class=s2>&quot;Invalid items type </span><span class=si>{}</span><span class=s2> expected list&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                            <span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&quot;items&quot;</span><span class=p>]))))</span>
                <span class=k>return</span> <span class=n>result</span>

            <span class=k>if</span> <span class=s2>&quot;success&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>result</span> <span class=ow>and</span> <span class=s2>&quot;message&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>error</span><span class=p>((</span>
                    <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> </span><span class=se>\&quot;</span><span class=si>{}</span><span class=se>\&quot;</span><span class=s2> Missing required keys&quot;</span>
                    <span class=s2>&quot; </span><span class=se>\&quot;</span><span class=s2>success</span><span class=se>\&quot;</span><span class=s2> and </span><span class=se>\&quot;</span><span class=s2>message</span><span class=se>\&quot;</span><span class=s2> in callback output. This is&quot;</span>
                    <span class=s2>&quot; soft fail.&quot;</span>
                <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>handler_type</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_label</span><span class=p>))</span>

            <span class=k>elif</span> <span class=s2>&quot;message&quot;</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>if</span> <span class=s2>&quot;success&quot;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
                    <span class=n>result</span><span class=p>[</span><span class=s2>&quot;success&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
                <span class=k>return</span> <span class=n>result</span>

            <span class=c1># Fallback to &#39;bool&#39; result</span>
            <span class=n>result</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;success&quot;</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>

        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>result</span><span class=p>,</span> <span class=nb>bool</span><span class=p>):</span>
            <span class=k>if</span> <span class=n>result</span><span class=p>:</span>
                <span class=k>return</span> <span class=p>{</span>
                    <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
                    <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> finished.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>full_label</span><span class=p>)</span>
                <span class=p>}</span>
            <span class=k>return</span> <span class=p>{</span>
                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
                <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2> failed.&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>full_label</span><span class=p>)</span>
            <span class=p>}</span>

        <span class=k>return</span> <span class=n>result</span>

    <span class=nd>@staticmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>roles_check</span><span class=p>(</span>
        <span class=n>settings_roles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
        <span class=n>user_roles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
        <span class=n>default</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Compare roles from setting and user&#39;s roles.</span>

<span class=sd>        Args:</span>
<span class=sd>            settings_roles(list): List of role names from settings.</span>
<span class=sd>            user_roles(list): User&#39;s lowered role names.</span>
<span class=sd>            default(bool): If &#39;settings_roles&#39; is empty list.</span>

<span class=sd>        Returns:</span>
<span class=sd>            bool: &#39;True&#39; if user has at least one role from settings or</span>
<span class=sd>                default if &#39;settings_roles&#39; is empty.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>settings_roles</span><span class=p>:</span>
            <span class=k>return</span> <span class=n>default</span>

        <span class=n>user_roles</span> <span class=o>=</span> <span class=p>{</span>
            <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
            <span class=k>for</span> <span class=n>role_name</span> <span class=ow>in</span> <span class=n>user_roles</span>
        <span class=p>}</span>
        <span class=k>for</span> <span class=n>role_name</span> <span class=ow>in</span> <span class=n>settings_roles</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>user_roles</span><span class=p>:</span>
                <span class=k>return</span> <span class=kc>True</span>
        <span class=k>return</span> <span class=kc>False</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_user_entity_from_event</span><span class=p>(</span>
        <span class=bp>cls</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>user</span><span class=o>.</span><span class=n>User</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Query user entity from event.&quot;&quot;&quot;</span>

        <span class=n>not_set</span> <span class=o>=</span> <span class=nb>object</span><span class=p>()</span>

        <span class=c1># Check if user is already stored in event data</span>
        <span class=n>user_entity</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user_entity&quot;</span><span class=p>,</span> <span class=n>not_set</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>user_entity</span> <span class=ow>is</span> <span class=n>not_set</span><span class=p>:</span>
            <span class=c1># Query user entity from event</span>
            <span class=n>user_info</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;source&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=p>{})</span>
            <span class=n>user_id</span> <span class=o>=</span> <span class=n>user_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>
            <span class=n>username</span> <span class=o>=</span> <span class=n>user_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>user_id</span><span class=p>:</span>
                <span class=n>user_entity</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
                    <span class=s2>&quot;User where id is </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
                <span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>user_entity</span> <span class=ow>and</span> <span class=n>username</span><span class=p>:</span>
                <span class=n>user_entity</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
                    <span class=s2>&quot;User where username is </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
                <span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;user_entity&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_entity</span>

        <span class=k>return</span> <span class=n>user_entity</span>

    <span class=nd>@classmethod</span>
    <span class=k>def</span><span class=w> </span><span class=nf>get_user_roles_from_event</span><span class=p>(</span>
        <span class=bp>cls</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
        <span class=n>lower</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Get user roles based on data in event.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): Prepared ftrack session.</span>
<span class=sd>            event (ftrack_api.event.Event): Event which is processed.</span>
<span class=sd>            lower (Optional[bool]): Lower the role names. Default &#39;False&#39;.</span>

<span class=sd>        Returns:</span>
<span class=sd>            List[str]: List of user roles.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>not_set</span> <span class=o>=</span> <span class=nb>object</span><span class=p>()</span>

        <span class=n>user_roles</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user_roles&quot;</span><span class=p>,</span> <span class=n>not_set</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>user_roles</span> <span class=ow>is</span> <span class=n>not_set</span><span class=p>:</span>
            <span class=n>user_roles</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=n>user_entity</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>get_user_entity_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>role</span> <span class=ow>in</span> <span class=n>user_entity</span><span class=p>[</span><span class=s2>&quot;user_security_roles&quot;</span><span class=p>]:</span>
                <span class=n>role_name</span> <span class=o>=</span> <span class=n>role</span><span class=p>[</span><span class=s2>&quot;security_role&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
                <span class=k>if</span> <span class=n>lower</span><span class=p>:</span>
                    <span class=n>role_name</span> <span class=o>=</span> <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
                <span class=n>user_roles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>role_name</span><span class=p>)</span>
            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;user_roles&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_roles</span>
        <span class=k>return</span> <span class=n>user_roles</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_project_name_from_event_with_entities</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Load or query and fill project entity from/to event data.</span>

<span class=sd>        Project data are stored by ftrack id because in most cases it is</span>
<span class=sd>        easier to access project id than project name.</span>

<span class=sd>        Args:</span>
<span class=sd>            session (ftrack_api.Session): Current session.</span>
<span class=sd>            event (ftrack_api.Event): Processed event by session.</span>
<span class=sd>            entities (List[Any]): ftrack entities of selection.</span>

<span class=sd>        Returns:</span>
<span class=sd>            Optional[str]: Project name from event data.</span>

<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Try to get project entity from event</span>
        <span class=n>project_name</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;project_name&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span><span class=p>:</span>
            <span class=n>project_entity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_project_from_entity</span><span class=p>(</span>
                <span class=n>entities</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>session</span>
            <span class=p>)</span>
            <span class=n>project_name</span> <span class=o>=</span> <span class=n>project_entity</span><span class=p>[</span><span class=s2>&quot;full_name&quot;</span><span class=p>]</span>

            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;project_name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>project_name</span>
        <span class=k>return</span> <span class=n>project_name</span>

    <span class=k>def</span><span class=w> </span><span class=nf>get_ftrack_settings</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
        <span class=n>project_name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_project_name_from_event_with_entities</span><span class=p>(</span>
            <span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>entities</span>
        <span class=p>)</span>
        <span class=n>project_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_project_settings_from_event</span><span class=p>(</span>
            <span class=n>event</span><span class=p>,</span> <span class=n>project_name</span>
        <span class=p>)</span>
        <span class=k>return</span> <span class=n>project_settings</span><span class=p>[</span><span class=s2>&quot;ftrack&quot;</span><span class=p>]</span>

    <span class=k>def</span><span class=w> </span><span class=nf>valid_roles</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span>
        <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
        <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
        <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Validate user roles by settings.</span>

<span class=sd>        Method requires to have set `settings_key` attribute.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=n>ftrack_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_ftrack_settings</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>entities</span><span class=p>)</span>
        <span class=n>settings</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>ftrack_settings</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_frack_subkey</span><span class=p>][</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_key</span><span class=p>]</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>settings_enabled_key</span><span class=p>:</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_enabled_key</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
                <span class=k>return</span> <span class=kc>False</span>

        <span class=n>user_role_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_user_roles_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>roles_check</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role_list&quot;</span><span class=p>),</span> <span class=n>user_role_list</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>False</span>
        <span class=k>return</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.full_label class="doc doc-heading"> <code class="highlight language-python"><span class=n>full_label</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Full label of action.</p> <p>Value of full label is cached.</p> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>str</code></td> <td> <code><span title=str>str</span></code> </td> <td> <div class=doc-md-description> <p>Label created from 'label' and 'variant' attributes.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.discover class="doc doc-heading"> <code class="highlight language-python"><span class=n>discover</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Decide if action is showed to used based on event data.</p> <p>Action should override the method to implement logic to show the action. The most common logic is based on combination of user roles and selected entities.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Session which triggered callback of the event.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>entities</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Prepared list of entities from event data.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>event</code> </td> <td> <code><span title=ftrack_api.Event>Event</span></code> </td> <td> <div class=doc-md-description> <p>ftrack event which caused this callback is triggered.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>True if action should be returned.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>171</span>
<span class=normal>172</span>
<span class=normal>173</span>
<span class=normal>174</span>
<span class=normal>175</span>
<span class=normal>176</span>
<span class=normal>177</span>
<span class=normal>178</span>
<span class=normal>179</span>
<span class=normal>180</span>
<span class=normal>181</span>
<span class=normal>182</span>
<span class=normal>183</span>
<span class=normal>184</span>
<span class=normal>185</span>
<span class=normal>186</span>
<span class=normal>187</span>
<span class=normal>188</span>
<span class=normal>189</span>
<span class=normal>190</span>
<span class=normal>191</span>
<span class=normal>192</span>
<span class=normal>193</span>
<span class=normal>194</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>discover</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Decide if action is showed to used based on event data.</span>

<span class=sd>    Action should override the method to implement logic to show the</span>
<span class=sd>    action. The most common logic is based on combination of user roles</span>
<span class=sd>    and selected entities.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Session which triggered callback of</span>
<span class=sd>            the event.</span>
<span class=sd>        entities (List[Any]): Prepared list of entities from event data.</span>
<span class=sd>        event (ftrack_api.Event): ftrack event which caused this callback</span>
<span class=sd>            is triggered.</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: True if action should be returned.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_project_name_from_event_with_entities class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_project_name_from_event_with_entities</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>entities</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Load or query and fill project entity from/to event data.</p> <p>Project data are stored by ftrack id because in most cases it is easier to access project id than project name.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Current session.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>event</code> </td> <td> <code><span title=ftrack_api.Event>Event</span></code> </td> <td> <div class=doc-md-description> <p>Processed event by session.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>entities</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>ftrack entities of selection.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>Optional[str]: Project name from event data.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>507</span>
<span class=normal>508</span>
<span class=normal>509</span>
<span class=normal>510</span>
<span class=normal>511</span>
<span class=normal>512</span>
<span class=normal>513</span>
<span class=normal>514</span>
<span class=normal>515</span>
<span class=normal>516</span>
<span class=normal>517</span>
<span class=normal>518</span>
<span class=normal>519</span>
<span class=normal>520</span>
<span class=normal>521</span>
<span class=normal>522</span>
<span class=normal>523</span>
<span class=normal>524</span>
<span class=normal>525</span>
<span class=normal>526</span>
<span class=normal>527</span>
<span class=normal>528</span>
<span class=normal>529</span>
<span class=normal>530</span>
<span class=normal>531</span>
<span class=normal>532</span>
<span class=normal>533</span>
<span class=normal>534</span>
<span class=normal>535</span>
<span class=normal>536</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>get_project_name_from_event_with_entities</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
    <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Load or query and fill project entity from/to event data.</span>

<span class=sd>    Project data are stored by ftrack id because in most cases it is</span>
<span class=sd>    easier to access project id than project name.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Current session.</span>
<span class=sd>        event (ftrack_api.Event): Processed event by session.</span>
<span class=sd>        entities (List[Any]): ftrack entities of selection.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Optional[str]: Project name from event data.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Try to get project entity from event</span>
    <span class=n>project_name</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;project_name&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>project_name</span><span class=p>:</span>
        <span class=n>project_entity</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_project_from_entity</span><span class=p>(</span>
            <span class=n>entities</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>session</span>
        <span class=p>)</span>
        <span class=n>project_name</span> <span class=o>=</span> <span class=n>project_entity</span><span class=p>[</span><span class=s2>&quot;full_name&quot;</span><span class=p>]</span>

        <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;project_name&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>project_name</span>
    <span class=k>return</span> <span class=n>project_name</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_entity_from_event class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_user_entity_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Query user entity from event.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>446</span>
<span class=normal>447</span>
<span class=normal>448</span>
<span class=normal>449</span>
<span class=normal>450</span>
<span class=normal>451</span>
<span class=normal>452</span>
<span class=normal>453</span>
<span class=normal>454</span>
<span class=normal>455</span>
<span class=normal>456</span>
<span class=normal>457</span>
<span class=normal>458</span>
<span class=normal>459</span>
<span class=normal>460</span>
<span class=normal>461</span>
<span class=normal>462</span>
<span class=normal>463</span>
<span class=normal>464</span>
<span class=normal>465</span>
<span class=normal>466</span>
<span class=normal>467</span>
<span class=normal>468</span>
<span class=normal>469</span>
<span class=normal>470</span>
<span class=normal>471</span>
<span class=normal>472</span>
<span class=normal>473</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>get_user_entity_from_event</span><span class=p>(</span>
    <span class=bp>cls</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>user</span><span class=o>.</span><span class=n>User</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Query user entity from event.&quot;&quot;&quot;</span>

    <span class=n>not_set</span> <span class=o>=</span> <span class=nb>object</span><span class=p>()</span>

    <span class=c1># Check if user is already stored in event data</span>
    <span class=n>user_entity</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user_entity&quot;</span><span class=p>,</span> <span class=n>not_set</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>user_entity</span> <span class=ow>is</span> <span class=n>not_set</span><span class=p>:</span>
        <span class=c1># Query user entity from event</span>
        <span class=n>user_info</span> <span class=o>=</span> <span class=n>event</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;source&quot;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user&quot;</span><span class=p>,</span> <span class=p>{})</span>
        <span class=n>user_id</span> <span class=o>=</span> <span class=n>user_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;id&quot;</span><span class=p>)</span>
        <span class=n>username</span> <span class=o>=</span> <span class=n>user_info</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;username&quot;</span><span class=p>)</span>
        <span class=k>if</span> <span class=n>user_id</span><span class=p>:</span>
            <span class=n>user_entity</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
                <span class=s2>&quot;User where id is </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>user_id</span><span class=p>)</span>
            <span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>user_entity</span> <span class=ow>and</span> <span class=n>username</span><span class=p>:</span>
            <span class=n>user_entity</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
                <span class=s2>&quot;User where username is </span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
            <span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>
        <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;user_entity&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_entity</span>

    <span class=k>return</span> <span class=n>user_entity</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.get_user_roles_from_event class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_user_roles_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>lower</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Get user roles based on data in event.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Prepared ftrack session.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>event</code> </td> <td> <code><span title=ftrack_api.event.Event>Event</span></code> </td> <td> <div class=doc-md-description> <p>Event which is processed.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>lower</code> </td> <td> <code><span title=typing.Optional>Optional</span>[<span title=bool>bool</span>]</code> </td> <td> <div class=doc-md-description> <p>Lower the role names. Default 'False'.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.List>List</span>[<span title=str>str</span>]</code> </td> <td> <div class=doc-md-description> <p>List[str]: List of user roles.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>475</span>
<span class=normal>476</span>
<span class=normal>477</span>
<span class=normal>478</span>
<span class=normal>479</span>
<span class=normal>480</span>
<span class=normal>481</span>
<span class=normal>482</span>
<span class=normal>483</span>
<span class=normal>484</span>
<span class=normal>485</span>
<span class=normal>486</span>
<span class=normal>487</span>
<span class=normal>488</span>
<span class=normal>489</span>
<span class=normal>490</span>
<span class=normal>491</span>
<span class=normal>492</span>
<span class=normal>493</span>
<span class=normal>494</span>
<span class=normal>495</span>
<span class=normal>496</span>
<span class=normal>497</span>
<span class=normal>498</span>
<span class=normal>499</span>
<span class=normal>500</span>
<span class=normal>501</span>
<span class=normal>502</span>
<span class=normal>503</span>
<span class=normal>504</span>
<span class=normal>505</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@classmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>get_user_roles_from_event</span><span class=p>(</span>
    <span class=bp>cls</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
    <span class=n>lower</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Get user roles based on data in event.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Prepared ftrack session.</span>
<span class=sd>        event (ftrack_api.event.Event): Event which is processed.</span>
<span class=sd>        lower (Optional[bool]): Lower the role names. Default &#39;False&#39;.</span>

<span class=sd>    Returns:</span>
<span class=sd>        List[str]: List of user roles.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>not_set</span> <span class=o>=</span> <span class=nb>object</span><span class=p>()</span>

    <span class=n>user_roles</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;user_roles&quot;</span><span class=p>,</span> <span class=n>not_set</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>user_roles</span> <span class=ow>is</span> <span class=n>not_set</span><span class=p>:</span>
        <span class=n>user_roles</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=n>user_entity</span> <span class=o>=</span> <span class=bp>cls</span><span class=o>.</span><span class=n>get_user_entity_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>role</span> <span class=ow>in</span> <span class=n>user_entity</span><span class=p>[</span><span class=s2>&quot;user_security_roles&quot;</span><span class=p>]:</span>
            <span class=n>role_name</span> <span class=o>=</span> <span class=n>role</span><span class=p>[</span><span class=s2>&quot;security_role&quot;</span><span class=p>][</span><span class=s2>&quot;name&quot;</span><span class=p>]</span>
            <span class=k>if</span> <span class=n>lower</span><span class=p>:</span>
                <span class=n>role_name</span> <span class=o>=</span> <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
            <span class=n>user_roles</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>role_name</span><span class=p>)</span>
        <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;user_roles&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>user_roles</span>
    <span class=k>return</span> <span class=n>user_roles</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.interface class="doc doc-heading"> <code class="highlight language-python"><span class=n>interface</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Show an interface to user befor the action is processed.</p> <p>This is part of launch callback which gives option to return ftrack widgets items. These items are showed to user which can fill/change values and submit them.</p> <p>Interface must in that case handle if event contains values from user.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Connected ftrack api session.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>entities</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Entities on which was action triggered.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>event</code> </td> <td> <code><span title=ftrack_api.Event>Event</span></code> </td> <td> <div class=doc-md-description> <p>Event which triggered launch callback.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Union>Union</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>], <span title=typing.List>List</span>[<span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]]</code> </td> <td> <div class=doc-md-description> <p>Union[None, List[Dict[str, Any], Dict[str, Any]]: None if nothing should be showed, list of items to show or dictionary with 'items' key and possibly additional data (e.g. submit button label).</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>347</span>
<span class=normal>348</span>
<span class=normal>349</span>
<span class=normal>350</span>
<span class=normal>351</span>
<span class=normal>352</span>
<span class=normal>353</span>
<span class=normal>354</span>
<span class=normal>355</span>
<span class=normal>356</span>
<span class=normal>357</span>
<span class=normal>358</span>
<span class=normal>359</span>
<span class=normal>360</span>
<span class=normal>361</span>
<span class=normal>362</span>
<span class=normal>363</span>
<span class=normal>364</span>
<span class=normal>365</span>
<span class=normal>366</span>
<span class=normal>367</span>
<span class=normal>368</span>
<span class=normal>369</span>
<span class=normal>370</span>
<span class=normal>371</span>
<span class=normal>372</span>
<span class=normal>373</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>interface</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>],</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Show an interface to user befor the action is processed.</span>

<span class=sd>    This is part of launch callback which gives option to return ftrack</span>
<span class=sd>    widgets items. These items are showed to user which can fill/change</span>
<span class=sd>    values and submit them.</span>

<span class=sd>    Interface must in that case handle if event contains values from user.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Connected ftrack api session.</span>
<span class=sd>        entities (List[Any]): Entities on which was action triggered.</span>
<span class=sd>        event (ftrack_api.Event): Event which triggered launch callback.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[None, List[Dict[str, Any], Dict[str, Any]]: None if nothing</span>
<span class=sd>            should be showed, list of items to show or dictionary with</span>
<span class=sd>            &#39;items&#39; key and possibly additional data</span>
<span class=sd>            (e.g. submit button label).</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>return</span> <span class=kc>None</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.launch class="doc doc-heading"> <code class="highlight language-python"><span class=n>launch</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Main part of handling event callback.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>session</code> </td> <td> <code><span title=ftrack_api.Session>Session</span></code> </td> <td> <div class=doc-md-description> <p>Session which queried entities.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>entities</code> </td> <td> <code><span title=typing.List>List</span>[<span title=typing.Any>Any</span>]</code> </td> <td> <div class=doc-md-description> <p>Prequeried entities based on event data.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>event</code> </td> <td> <code><span title=ftrack_api.Event>Event</span></code> </td> <td> <div class=doc-md-description> <p>ftrack event to process.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code><span title=typing.Optional>Optional</span>[<span title=typing.Union>Union</span>[<span title=bool>bool</span>, <span title=typing.Dict>Dict</span>[<span title=str>str</span>, <span title=typing.Any>Any</span>]]]</code> </td> <td> <div class=doc-md-description> <p>Union[bool, Dict[str, Any]]: True or false for success or fail, or more complex data structure e.g. to show interface to user.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>296</span>
<span class=normal>297</span>
<span class=normal>298</span>
<span class=normal>299</span>
<span class=normal>300</span>
<span class=normal>301</span>
<span class=normal>302</span>
<span class=normal>303</span>
<span class=normal>304</span>
<span class=normal>305</span>
<span class=normal>306</span>
<span class=normal>307</span>
<span class=normal>308</span>
<span class=normal>309</span>
<span class=normal>310</span>
<span class=normal>311</span>
<span class=normal>312</span>
<span class=normal>313</span>
<span class=normal>314</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>launch</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Union</span><span class=p>[</span><span class=nb>bool</span><span class=p>,</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]]:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Main part of handling event callback.</span>

<span class=sd>    Args:</span>
<span class=sd>        session (ftrack_api.Session): Session which queried entities.</span>
<span class=sd>        entities (List[Any]): Prequeried entities based on event data.</span>
<span class=sd>        event (ftrack_api.Event): ftrack event to process.</span>

<span class=sd>    Returns:</span>
<span class=sd>        Union[bool, Dict[str, Any]]: True or false for success or fail,</span>
<span class=sd>            or more complex data structure e.g. to show interface to user.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>raise</span> <span class=ne>NotImplementedError</span><span class=p>()</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.register class="doc doc-heading"> <code class="highlight language-python"><span class=n>register</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Register to ftrack topics to discover and launch action.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Register to ftrack topics to discover and launch action.&quot;&quot;&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
        <span class=s2>&quot;topic=ftrack.action.discover&quot;</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_discover</span><span class=p>,</span>
        <span class=n>priority</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>priority</span>
    <span class=p>)</span>

    <span class=n>launch_subscription</span> <span class=o>=</span> <span class=p>(</span>
        <span class=s2>&quot;topic=ftrack.action.launch and data.actionIdentifier=</span><span class=si>{}</span><span class=s2>&quot;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>launch_identifier</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span><span class=n>launch_subscription</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>_launch</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.roles_check class="doc doc-heading"> <code class="highlight language-python"><span class=n>roles_check</span><span class=p>(</span><span class=n>settings_roles</span><span class=p>,</span> <span class=n>user_roles</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents "> <p>Compare roles from setting and user's roles.</p> <p><span class=doc-section-title>Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td> <code>settings_roles(list)</code> </td> <td> </td> <td> <div class=doc-md-description> <p>List of role names from settings.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>user_roles(list)</code> </td> <td> </td> <td> <div class=doc-md-description> <p>User's lowered role names.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class=doc-section-item> <td> <code>default(bool)</code> </td> <td> </td> <td> <div class=doc-md-description> <p>If 'settings_roles' is empty list.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class=doc-section-title>Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class=doc-section-item> <td><code>bool</code></td> <td> <code><span title=bool>bool</span></code> </td> <td> <div class=doc-md-description> <p>'True' if user has at least one role from settings or default if 'settings_roles' is empty.</p> </div> </td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>416</span>
<span class=normal>417</span>
<span class=normal>418</span>
<span class=normal>419</span>
<span class=normal>420</span>
<span class=normal>421</span>
<span class=normal>422</span>
<span class=normal>423</span>
<span class=normal>424</span>
<span class=normal>425</span>
<span class=normal>426</span>
<span class=normal>427</span>
<span class=normal>428</span>
<span class=normal>429</span>
<span class=normal>430</span>
<span class=normal>431</span>
<span class=normal>432</span>
<span class=normal>433</span>
<span class=normal>434</span>
<span class=normal>435</span>
<span class=normal>436</span>
<span class=normal>437</span>
<span class=normal>438</span>
<span class=normal>439</span>
<span class=normal>440</span>
<span class=normal>441</span>
<span class=normal>442</span>
<span class=normal>443</span>
<span class=normal>444</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nd>@staticmethod</span>
<span class=k>def</span><span class=w> </span><span class=nf>roles_check</span><span class=p>(</span>
    <span class=n>settings_roles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
    <span class=n>user_roles</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>],</span>
    <span class=n>default</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>bool</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Compare roles from setting and user&#39;s roles.</span>

<span class=sd>    Args:</span>
<span class=sd>        settings_roles(list): List of role names from settings.</span>
<span class=sd>        user_roles(list): User&#39;s lowered role names.</span>
<span class=sd>        default(bool): If &#39;settings_roles&#39; is empty list.</span>

<span class=sd>    Returns:</span>
<span class=sd>        bool: &#39;True&#39; if user has at least one role from settings or</span>
<span class=sd>            default if &#39;settings_roles&#39; is empty.</span>

<span class=sd>    &quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>settings_roles</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>default</span>

    <span class=n>user_roles</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
        <span class=k>for</span> <span class=n>role_name</span> <span class=ow>in</span> <span class=n>user_roles</span>
    <span class=p>}</span>
    <span class=k>for</span> <span class=n>role_name</span> <span class=ow>in</span> <span class=n>settings_roles</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>role_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>user_roles</span><span class=p>:</span>
            <span class=k>return</span> <span class=kc>True</span>
    <span class=k>return</span> <span class=kc>False</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction.valid_roles class="doc doc-heading"> <code class="highlight language-python"><span class=n>valid_roles</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span></code> </h3> <div class="doc doc-contents "> <p>Validate user roles by settings.</p> <p>Method requires to have set <code>settings_key</code> attribute.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>552</span>
<span class=normal>553</span>
<span class=normal>554</span>
<span class=normal>555</span>
<span class=normal>556</span>
<span class=normal>557</span>
<span class=normal>558</span>
<span class=normal>559</span>
<span class=normal>560</span>
<span class=normal>561</span>
<span class=normal>562</span>
<span class=normal>563</span>
<span class=normal>564</span>
<span class=normal>565</span>
<span class=normal>566</span>
<span class=normal>567</span>
<span class=normal>568</span>
<span class=normal>569</span>
<span class=normal>570</span>
<span class=normal>571</span>
<span class=normal>572</span>
<span class=normal>573</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>valid_roles</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>session</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span>
    <span class=n>entities</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ftrack_api</span><span class=o>.</span><span class=n>entity</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Entity</span><span class=p>],</span>
    <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Validate user roles by settings.</span>

<span class=sd>    Method requires to have set `settings_key` attribute.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>ftrack_settings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_ftrack_settings</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>,</span> <span class=n>entities</span><span class=p>)</span>
    <span class=n>settings</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>ftrack_settings</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_frack_subkey</span><span class=p>][</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_key</span><span class=p>]</span>
    <span class=p>)</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>settings_enabled_key</span><span class=p>:</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>settings_enabled_key</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
            <span class=k>return</span> <span class=kc>False</span>

    <span class=n>user_role_list</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_user_roles_from_event</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>roles_check</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;role_list&quot;</span><span class=p>),</span> <span class=n>user_role_list</span><span class=p>):</span>
        <span class=k>return</span> <span class=kc>False</span>
    <span class=k>return</span> <span class=kc>True</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction class="doc doc-heading"> <code>LocalAction</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="BaseAction (client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction)" href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction>BaseAction</a></code></p> <p>Action that warn user when more Processes with same action are running.</p> <p>Action is launched all the time but if id does not match id of current instanace then message is shown to user.</p> <p>Handy for actions where matters if is executed on specific machine.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>576</span>
<span class=normal>577</span>
<span class=normal>578</span>
<span class=normal>579</span>
<span class=normal>580</span>
<span class=normal>581</span>
<span class=normal>582</span>
<span class=normal>583</span>
<span class=normal>584</span>
<span class=normal>585</span>
<span class=normal>586</span>
<span class=normal>587</span>
<span class=normal>588</span>
<span class=normal>589</span>
<span class=normal>590</span>
<span class=normal>591</span>
<span class=normal>592</span>
<span class=normal>593</span>
<span class=normal>594</span>
<span class=normal>595</span>
<span class=normal>596</span>
<span class=normal>597</span>
<span class=normal>598</span>
<span class=normal>599</span>
<span class=normal>600</span>
<span class=normal>601</span>
<span class=normal>602</span>
<span class=normal>603</span>
<span class=normal>604</span>
<span class=normal>605</span>
<span class=normal>606</span>
<span class=normal>607</span>
<span class=normal>608</span>
<span class=normal>609</span>
<span class=normal>610</span>
<span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span>
<span class=normal>634</span>
<span class=normal>635</span>
<span class=normal>636</span>
<span class=normal>637</span>
<span class=normal>638</span>
<span class=normal>639</span>
<span class=normal>640</span>
<span class=normal>641</span>
<span class=normal>642</span>
<span class=normal>643</span>
<span class=normal>644</span>
<span class=normal>645</span>
<span class=normal>646</span>
<span class=normal>647</span>
<span class=normal>648</span>
<span class=normal>649</span>
<span class=normal>650</span>
<span class=normal>651</span>
<span class=normal>652</span>
<span class=normal>653</span>
<span class=normal>654</span>
<span class=normal>655</span>
<span class=normal>656</span>
<span class=normal>657</span>
<span class=normal>658</span>
<span class=normal>659</span>
<span class=normal>660</span>
<span class=normal>661</span>
<span class=normal>662</span>
<span class=normal>663</span>
<span class=normal>664</span>
<span class=normal>665</span>
<span class=normal>666</span>
<span class=normal>667</span>
<span class=normal>668</span>
<span class=normal>669</span>
<span class=normal>670</span>
<span class=normal>671</span>
<span class=normal>672</span>
<span class=normal>673</span>
<span class=normal>674</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>LocalAction</span><span class=p>(</span><span class=n>BaseAction</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Action that warn user when more Processes with same action are running.</span>

<span class=sd>    Action is launched all the time but if id does not match id of current</span>
<span class=sd>    instanace then message is shown to user.</span>

<span class=sd>    Handy for actions where matters if is executed on specific machine.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>__ignore_handler_class</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>
    <span class=n>_full_launch_identifier</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>None</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>discover_identifier</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_discover_identifier</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_discover_identifier</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_identifier</span><span class=p>()</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_discover_identifier</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>launch_identifier</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Catch all topics with same identifier.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_launch_identifier</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_launch_identifier</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.*&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_launch_identifier</span>

    <span class=nd>@property</span>
    <span class=k>def</span><span class=w> </span><span class=nf>full_launch_identifier</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Catch all topics with same identifier.&quot;&quot;&quot;</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_full_launch_identifier</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_full_launch_identifier</span> <span class=o>=</span> <span class=s2>&quot;</span><span class=si>{}</span><span class=s2>.</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>identifier</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>process_identifier</span><span class=p>()</span>
            <span class=p>)</span>
        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_full_launch_identifier</span>

    <span class=k>def</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>        </span><span class=sd>&quot;&quot;&quot;Register to ftrack topics to discover and launch action.</span>

<span class=sd>        Filter events to this session user.</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=c1># Subscribe to discover topic for user under this session</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
            <span class=s2>&quot;topic=ftrack.action.discover and source.user.username=</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>api_user</span>
            <span class=p>),</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_discover</span><span class=p>,</span>
            <span class=n>priority</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>priority</span>
        <span class=p>)</span>

        <span class=n>launch_subscription</span> <span class=o>=</span> <span class=p>(</span>
            <span class=s2>&quot;topic=ftrack.action.launch&quot;</span>
            <span class=s2>&quot; and data.actionIdentifier=</span><span class=si>{}</span><span class=s2>&quot;</span>
            <span class=s2>&quot; and source.user.username=</span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>launch_identifier</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>api_user</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
            <span class=n>launch_subscription</span><span class=p>,</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_launch</span>
        <span class=p>)</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_discover</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=n>entities</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_translate_event</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>entities</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=n>accepts</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>discover</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=p>,</span> <span class=n>entities</span><span class=p>,</span> <span class=n>event</span><span class=p>)</span>
        <span class=k>if</span> <span class=ow>not</span> <span class=n>accepts</span><span class=p>:</span>
            <span class=k>return</span>

        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=s2>&quot;Discovering action with selection: </span><span class=si>{0}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;selection&quot;</span><span class=p>,</span> <span class=p>[])</span>
        <span class=p>))</span>

        <span class=k>return</span> <span class=p>{</span>
            <span class=s2>&quot;items&quot;</span><span class=p>:</span> <span class=p>[{</span>
                <span class=s2>&quot;label&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>label</span><span class=p>,</span>
                <span class=s2>&quot;variant&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>variant</span><span class=p>,</span>
                <span class=s2>&quot;description&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>description</span><span class=p>,</span>
                <span class=s2>&quot;actionIdentifier&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>discover_identifier</span><span class=p>,</span>
                <span class=s2>&quot;icon&quot;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>icon</span><span class=p>,</span>
            <span class=p>}]</span>
        <span class=p>}</span>

    <span class=k>def</span><span class=w> </span><span class=nf>_launch</span><span class=p>(</span>
        <span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>:</span> <span class=n>ftrack_api</span><span class=o>.</span><span class=n>event</span><span class=o>.</span><span class=n>base</span><span class=o>.</span><span class=n>Event</span>
    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]:</span>
        <span class=n>event_identifier</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s2>&quot;data&quot;</span><span class=p>][</span><span class=s2>&quot;actionIdentifier&quot;</span><span class=p>]</span>
        <span class=c1># Check if identifier is same</span>
        <span class=c1># - show message that acion may not be triggered on this machine</span>
        <span class=k>if</span> <span class=n>event_identifier</span> <span class=o>!=</span> <span class=bp>self</span><span class=o>.</span><span class=n>full_launch_identifier</span><span class=p>:</span>
            <span class=k>return</span> <span class=p>{</span>
                <span class=s2>&quot;success&quot;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
                <span class=s2>&quot;message&quot;</span><span class=p>:</span> <span class=p>(</span>
                    <span class=s2>&quot;There are running more AYON processes&quot;</span>
                    <span class=s2>&quot; where this action could be launched.&quot;</span>
                <span class=p>)</span>
            <span class=p>}</span>
        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=n>_launch</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.full_launch_identifier class="doc doc-heading"> <code class="highlight language-python"><span class=n>full_launch_identifier</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Catch all topics with same identifier.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.launch_identifier class="doc doc-heading"> <code class="highlight language-python"><span class=n>launch_identifier</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents "> <p>Catch all topics with same identifier.</p> </div> </div> <div class="doc doc-object doc-function"> <h3 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.LocalAction.register class="doc doc-heading"> <code class="highlight language-python"><span class=n>register</span><span class=p>()</span></code> </h3> <div class="doc doc-contents "> <p>Register to ftrack topics to discover and launch action.</p> <p>Filter events to this session user.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>611</span>
<span class=normal>612</span>
<span class=normal>613</span>
<span class=normal>614</span>
<span class=normal>615</span>
<span class=normal>616</span>
<span class=normal>617</span>
<span class=normal>618</span>
<span class=normal>619</span>
<span class=normal>620</span>
<span class=normal>621</span>
<span class=normal>622</span>
<span class=normal>623</span>
<span class=normal>624</span>
<span class=normal>625</span>
<span class=normal>626</span>
<span class=normal>627</span>
<span class=normal>628</span>
<span class=normal>629</span>
<span class=normal>630</span>
<span class=normal>631</span>
<span class=normal>632</span>
<span class=normal>633</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>def</span><span class=w> </span><span class=nf>register</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Register to ftrack topics to discover and launch action.</span>

<span class=sd>    Filter events to this session user.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=c1># Subscribe to discover topic for user under this session</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
        <span class=s2>&quot;topic=ftrack.action.discover and source.user.username=</span><span class=si>{}</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>api_user</span>
        <span class=p>),</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_discover</span><span class=p>,</span>
        <span class=n>priority</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>priority</span>
    <span class=p>)</span>

    <span class=n>launch_subscription</span> <span class=o>=</span> <span class=p>(</span>
        <span class=s2>&quot;topic=ftrack.action.launch&quot;</span>
        <span class=s2>&quot; and data.actionIdentifier=</span><span class=si>{}</span><span class=s2>&quot;</span>
        <span class=s2>&quot; and source.user.username=</span><span class=si>{}</span><span class=s2>&quot;</span>
    <span class=p>)</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>launch_identifier</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>api_user</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>event_hub</span><span class=o>.</span><span class=n>subscribe</span><span class=p>(</span>
        <span class=n>launch_subscription</span><span class=p>,</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>_launch</span>
    <span class=p>)</span>
</code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-class"> <h2 id=client.ayon_ftrack.common.event_handlers.ftrack_action_handler.ServerAction class="doc doc-heading"> <code>ServerAction</code> </h2> <div class="doc doc-contents "> <p class="doc doc-class-bases"> Bases: <code><a class="autorefs autorefs-internal" title="BaseAction (client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction)" href=#client.ayon_ftrack.common.event_handlers.ftrack_action_handler.BaseAction>BaseAction</a></code></p> <p>Action class meant to be used on event server.</p> <p>Unlike the <code>BaseAction</code> roles are not checked on register but on discover. For the same reason register is modified to not filter topics by username.</p> <details class=quote> <summary>Source code in <code>client/ayon_ftrack/common/event_handlers/ftrack_action_handler.py</code></summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>677</span>
<span class=normal>678</span>
<span class=normal>679</span>
<span class=normal>680</span>
<span class=normal>681</span>
<span class=normal>682</span>
<span class=normal>683</span>
<span class=normal>684</span>
<span class=normal>685</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>ServerAction</span><span class=p>(</span><span class=n>BaseAction</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Action class meant to be used on event server.</span>

<span class=sd>    Unlike the `BaseAction` roles are not checked on register but on discover.</span>
<span class=sd>    For the same reason register is modified to not filter topics by username.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>__ignore_handler_class</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>

    <span class=n>settings_frack_subkey</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&quot;service_event_handlers&quot;</span>
</code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> </div> </div> </div> </div> </div> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.sections", "navigation.path", "navigation.prune"], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>